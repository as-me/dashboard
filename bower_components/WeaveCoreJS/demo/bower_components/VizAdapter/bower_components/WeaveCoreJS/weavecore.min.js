this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.type=a,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=!!b,this.cancelable=!!c,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}var b=a.prototype;b.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0},b.stopPropagation=function(){this.propagationStopped=!0},b.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},b.remove=function(){this.removed=!0},b.clone=function(){return new a(this.type,this.bubbles,this.cancelable)},b.set=function(a){for(var b in a)this[b]=a[b];return this},b.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this._listeners=null,this._captureListeners=null}var b=a.prototype;a.initialize=function(a){a.addEventListener=b.addEventListener,a.on=b.on,a.removeEventListener=a.off=b.removeEventListener,a.removeAllEventListeners=b.removeAllEventListeners,a.hasEventListener=b.hasEventListener,a.dispatchEvent=b.dispatchEvent,a._dispatchEvent=b._dispatchEvent,a.willTrigger=b.willTrigger},b.addEventListener=function(a,b,c){var d;d=c?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var e=d[a];return e&&this.removeEventListener(a,b,c),e=d[a],e?e.push(b):d[a]=[b],b},b.on=function(a,b,c,d,e,f){return b.handleEvent&&(c=c||b,b=b.handleEvent),c=c||this,this.addEventListener(a,function(a){b.call(c,a,e),d&&a.remove()},f)},b.removeEventListener=function(a,b,c){var d=c?this._captureListeners:this._listeners;if(d){var e=d[a];if(e)for(var f=0,g=e.length;g>f;f++)if(e[f]==b){1==g?delete d[a]:e.splice(f,1);break}}},b.off=b.removeEventListener,b.removeAllEventListeners=function(a){a?(this._listeners&&delete this._listeners[a],this._captureListeners&&delete this._captureListeners[a]):this._listeners=this._captureListeners=null},b.dispatchEvent=function(a){if("string"==typeof a){var b=this._listeners;if(!b||!b[a])return!1;a=new createjs.Event(a)}else a.target&&a.clone&&(a=a.clone());try{a.target=this}catch(c){}if(a.bubbles&&this.parent){for(var d=this,e=[d];d.parent;)e.push(d=d.parent);var f,g=e.length;for(f=g-1;f>=0&&!a.propagationStopped;f--)e[f]._dispatchEvent(a,1+(0==f));for(f=1;g>f&&!a.propagationStopped;f++)e[f]._dispatchEvent(a,3)}else this._dispatchEvent(a,2);return a.defaultPrevented},b.hasEventListener=function(a){var b=this._listeners,c=this._captureListeners;return!!(b&&b[a]||c&&c[a])},b.willTrigger=function(a){for(var b=this;b;){if(b.hasEventListener(a))return!0;b=b.parent}return!1},b.toString=function(){return"[EventDispatcher]"},b._dispatchEvent=function(a,b){var c,d=1==b?this._captureListeners:this._listeners;if(a&&d){var e=d[a.type];if(!e||!(c=e.length))return;try{a.currentTarget=this}catch(f){}try{a.eventPhase=b}catch(f){}a.removed=!1,e=e.slice();for(var g=0;c>g&&!a.immediatePropagationStopped;g++){var h=e[g];h.handleEvent?h.handleEvent(a):h(a),a.removed&&(this.off(a.type,h,1==b),a.removed=!1)}}},createjs.EventDispatcher=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Ticker cannot be instantiated."}a.RAF_SYNCHED="synched",a.RAF="raf",a.TIMEOUT="timeout",a.useRAF=!1,a.timingMode=null,a.maxDelta=0,a.paused=!1,a.removeEventListener=null,a.removeAllEventListeners=null,a.dispatchEvent=null,a.hasEventListener=null,a._listeners=null,createjs.EventDispatcher.initialize(a),a._addEventListener=a.addEventListener,a.addEventListener=function(){return!a._inited&&a.init(),a._addEventListener.apply(a,arguments)},a._inited=!1,a._startTime=0,a._pausedTime=0,a._ticks=0,a._pausedTicks=0,a._interval=50,a._lastTime=0,a._times=null,a._tickTimes=null,a._timerId=null,a._raf=!0,a.setInterval=function(b){a._interval=b,a._inited&&a._setupTick()},a.getInterval=function(){return a._interval},a.setFPS=function(b){a.setInterval(1e3/b)},a.getFPS=function(){return 1e3/a._interval};try{Object.defineProperties(a,{interval:{get:a.getInterval,set:a.setInterval},framerate:{get:a.getFPS,set:a.setFPS}})}catch(b){console.log(b)}a.init=function(){a._inited||(a._inited=!0,a._times=[],a._tickTimes=[],a._startTime=a._getTime(),a._times.push(a._lastTime=0),a.interval=a._interval)},a.reset=function(){if(a._raf){var b=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;b&&b(a._timerId)}else clearTimeout(a._timerId);a.removeAllEventListeners("tick"),a._timerId=a._times=a._tickTimes=null,a._startTime=a._lastTime=a._ticks=0,a._inited=!1},a.getMeasuredTickTime=function(b){var c=0,d=a._tickTimes;if(!d||d.length<1)return-1;b=Math.min(d.length,b||0|a.getFPS());for(var e=0;b>e;e++)c+=d[e];return c/b},a.getMeasuredFPS=function(b){var c=a._times;return!c||c.length<2?-1:(b=Math.min(c.length-1,b||0|a.getFPS()),1e3/((c[0]-c[b])/b))},a.setPaused=function(b){a.paused=b},a.getPaused=function(){return a.paused},a.getTime=function(b){return a._startTime?a._getTime()-(b?a._pausedTime:0):-1},a.getEventTime=function(b){return a._startTime?(a._lastTime||a._startTime)-(b?a._pausedTime:0):-1},a.getTicks=function(b){return a._ticks-(b?a._pausedTicks:0)},a._handleSynch=function(){a._timerId=null,a._setupTick(),a._getTime()-a._lastTime>=.97*(a._interval-1)&&a._tick()},a._handleRAF=function(){a._timerId=null,a._setupTick(),a._tick()},a._handleTimeout=function(){a._timerId=null,a._setupTick(),a._tick()},a._setupTick=function(){if(null==a._timerId){var b=a.timingMode||a.useRAF&&a.RAF_SYNCHED;if(b==a.RAF_SYNCHED||b==a.RAF){var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(c)return a._timerId=c(b==a.RAF?a._handleRAF:a._handleSynch),void(a._raf=!0)}a._raf=!1,a._timerId=setTimeout(a._handleTimeout,a._interval)}},a._tick=function(){var b=a.paused,c=a._getTime(),d=c-a._lastTime;if(a._lastTime=c,a._ticks++,b&&(a._pausedTicks++,a._pausedTime+=d),a.hasEventListener("tick")){var e=new createjs.Event("tick"),f=a.maxDelta;e.delta=f&&d>f?f:d,e.paused=b,e.time=c,e.runTime=c-a._pausedTime,a.dispatchEvent(e)}for(a._tickTimes.unshift(a._getTime()-c);a._tickTimes.length>100;)a._tickTimes.pop();for(a._times.unshift(c);a._times.length>100;)a._times.pop()};var c=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);a._getTime=function(){return(c&&c.call(performance)||(new Date).getTime())-a._startTime},createjs.Ticker=a}(),this.weavecore||(this.weavecore={}),function(){"use strict";function a(){}a.numericCompare=function(a,b){return isNaN(a)&&isNaN(b)?0:isNaN(a)?1:isNaN(b)?-1:b>a?-1:a>b?1:0},a.stringCompare=function(a,b,c){if(!(null!==a&&void 0!==a||null!==b&&void 0!==b))return 0;if(null===a||void 0===a)return 1;if(null===b||void 0===b)return-1;c&&(a=a.toLocaleLowerCase(),b=b.toLocaleLowerCase());var d=a.localeCompare(b);return-1>d?d=-1:d>1&&(d=1),d},a.dateCompare=function(a,b){if(!(null!==a&&void 0!==a||null!==b&&void 0!==b))return 0;if(null===a)return 1;if(null===b)return-1;var c=a.getTime(),d=b.getTime();return d>c?-1:c>d?1:isNaN(c)&&isNaN(d)?0:isNaN(c)?1:isNaN(d)?-1:0},weavecore.ObjectUtil=a}(),this.weavecore||(this.weavecore={}),function(){function a(){}a.compare=function(b,c){{var d;weavecore.ObjectUtil}if(b===c)return 0;if(null===b||void 0===b)return 1;if(null===c||void 0===c)return-1;var e=typeof b,f=typeof c;if(e!==f)return weavecore.ObjectUtil.stringCompare(e,f);if("boolean"===e)return weavecore.ObjectUtil.numericCompare(Number(b),Number(c));if("number"===e)return weavecore.ObjectUtil.numericCompare(b,c);if("string"===e)return weavecore.ObjectUtil.stringCompare(b,c);if("object"!==e)return 1;if(b instanceof Date&&c instanceof Date)return weavecore.ObjectUtil.dateCompare(b,c);if(Array.isArray(b)&&Array.isArray(c)){var g=b.length,h=c.length;if(h>g)return-1;if(g>h)return 1;for(var i=0;g>i;i++)if(d=a.compare(b[i],c[i]),0!==d)return d;return 0}var j=b.constructor.name,k=c.constructor.name;if(j!=k)return weavecore.ObjectUtil.stringCompare(j,k);var l;try{b[""],c[""]}catch(m){return 1}for(l in b)if(!c.hasOwnProperty(l))return-1;for(l in c){if(!b.hasOwnProperty(l))return 1;if(d=a.compare(b[l],c[l]),0!==d)return d}return 0},weavecore.StandardLib=a}(),this.weavecore||(this.weavecore={}),function(){function a(){}Object.defineProperty(a,"OBJECT_NAME",{value:"objectName"}),Object.defineProperty(a,"CLASS_NAME",{value:"className"}),Object.defineProperty(a,"SESSION_STATE",{value:"sessionState"}),a.create=function(b,c,d){var e={};return e[a.OBJECT_NAME]=b||null,e[a.CLASS_NAME]=c||null,e[a.SESSION_STATE]=d,e},a.isDynamicState=function(b){var c=0;for(var d in b){if(d!==a.OBJECT_NAME&&d!==a.CLASS_NAME&&d!==a.SESSION_STATE)return!1;c++}return 3==c},a.isDynamicStateArray=function(b){if(!Array.isArray(b))return!1;for(var c=!1,d=0;d<b.length;d++){var e=b[d];if(!("string"==typeof e||e instanceof String)){if(!a.isDynamicState(e))return!1;c=!0}}return c},weavecore.DynamicState=a}(),this.weavecore||(this.weavecore={}),function(){function a(){}weavecore.ILinkableObject=a}(),this.weavecore||(this.weavecore={}),function(){function a(b){a.debug=!1,this._linkableObject,this._lastTriggerStackTrace,this._oldEntries,this._callbackEntries=[],this._preCallback=b,this._runCallbacksIsPending=!1,this._delayCount=0,this._triggerCounter=a.DEFAULT_TRIGGER_COUNT,this._disposeCallbackEntries=[],this._wasDisposed=!1,this._runCallbacksCompleted}function b(c,d){this.context=c,this.callback=d,this.recursionCount=0,this.schedule=0,this.addCallback_stackTrace,this.removeCallback_stackTrace,a.debug&&(this.addCallback_stackTrace=new Error(b.STACK_TRACE_ADD).stack)}function c(a){c._initialized=!1,b.call(this,[],a),this.triggered=!1,this.triggeredAgain=!1,c._initialized||(weavecore.StageUtils.addEventCallback("tick",null,c._handleGroupedCallbacks.bind(this)),c._initialized=!0)}Object.defineProperty(a,"DEFAULT_TRIGGER_COUNT",{value:1}),a.prototype=new weavecore.ILinkableObject,a.prototype.constructor=a;var d=a.prototype;d.addImmediateCallback=function(a,c,d,e){if(null!==c&&void 0!==c){(null===d||void 0===d)&&(d=!1),(null===e||void 0===e)&&(e=!1),this.removeCallback(c);var f=new b(a,c);e&&(f.schedule=1),this._callbackEntries.push(f),d&&(f.recursionCount++,c.call(this),f.recursionCount--)}},d.triggerCallbacks=function(){return a.debug&&(this._lastTriggerStackTrace=new Error(a.STACK_TRACE_TRIGGER).stack()),this._delayCount>0?(this._triggerCounter++,void(this._runCallbacksIsPending=!0)):void this._runCallbacksImmediately.call(this)},d._runCallbacksImmediately=function(){var b=arguments;this._triggerCounter++,this._runCallbacksIsPending=!1,this._runCallbacksCompleted=!1;for(var c=0;2>c;c++)for(var d=0;d<this._callbackEntries.length&&(!this._runCallbacksCompleted||void 0!==this._preCallback&&null!==this._preCallback);d++){var e=this._callbackEntries[d];if(e.schedule==c){var f;if(f=null===e.callback||void 0===e.callback?!0:e.context instanceof a?e.context.wasDisposed:WeaveAPI.SessionManager.objectWasDisposed(e.context)){e.dispose();var g=this._callbackEntries.splice(d--,1);a.debug&&(this._oldEntries=this._oldEntries?this._oldEntries.concat(g):g)}else(0===e.recursionCount||void 0!==this._preCallback&&null!==this._preCallback)&&(e.recursionCount++,void 0!==this._preCallback&&null!==this._preCallback&&this._preCallback.apply(null,b),e.callback.call(),e.recursionCount--)}}this._runCallbacksCompleted=!0},d.removeCallback=function(a){c.removeGroupedCallback(this,a);for(var b=0;2>b;b++)for(var d=0===b?this._callbackEntries:this._disposeCallbackEntries,e=0;e<d.length;e++){var f=d[e];null!==f&&void 0!==f&&a===f.callback&&f.dispose()}},d.__defineGetter__("triggerCounter",function(){return this._triggerCounter}),d.__defineGetter__("callbacksAreDelayed",function(){return this._delayCount>0}),d.delayCallbacks=function(){this._delayCount++},d.resumeCallbacks=function(){this._delayCount>0&&this._delayCount--,0===this._delayCount&&this._runCallbacksIsPending&&this.triggerCallbacks()},d.addDisposeCallback=function(a,c){for(var d=0;d<this._disposeCallbackEntries.length;d++){var e=this._disposeCallbackEntries[d];if(e.callback===c)return}this._disposeCallbackEntries.push(new b(a,c))},d.dispose=function(){for(a.debug&&(this._oldEntries=this._oldEntries?this._oldEntries.concat(this._callbackEntries):this._callbackEntries.concat()),this._callbackEntries.length=0,this._wasDisposed=!0;this._disposeCallbackEntries.length;){var b=this._disposeCallbackEntries.shift();null===b.callback||void 0===b.callback||WeaveAPI.SessionManager.objectWasDisposed(b.context)||b.callback()}},d.__defineGetter__("wasDisposed",function(){return this._wasDisposed}),d.addGroupedCallback=function(a,b,d){(null===d||void 0===d)&&(d=!1),c.addGroupedCallback(this,a,b,d)},weavecore.CallbackCollection=a,Object.defineProperty(b,"STACK_TRACE_TRIGGER",{value:"This is the stack trace from when the callbacks were last triggered."}),Object.defineProperty(b,"STACK_TRACE_ADD",{value:"This is the stack trace from when the callback was added."}),Object.defineProperty(b,"STACK_TRACE_REMOVE",{value:"This is the stack trace from when the callback was removed."}),b.prototype.dispose=function(){a.debug&&null!==this.callback&&void 0!==this.callback&&(this.removeCallback_stackTrace=new Error(b.STACK_TRACE_REMOVE).stack),this.context=null,this.callback=null},weavecore.CallbackEntry=b,c.prototype=new b,c.prototype.constructor=c,c._handlingGroupedCallbacks=!1,c._handlingRecursiveGroupedCallbacks=!1,Object.defineProperty(c,"_entryLookup",{value:new Map}),Object.defineProperty(c,"_triggeredEntries",{value:[]}),c.addGroupedCallback=function(a,b,d,e){var f=c._entryLookup.get(d);f||(f=new c(d),c._entryLookup.set(d,f)),(null===b||void 0===b)&&(b=a),f.context.push(b),a.removeCallback(d),a.addImmediateCallback(null,f.trigger.bind(f),e)},c.removeGroupedCallback=function(a,b){var d=c._entryLookup.get(b);d&&a.removeCallback(d.trigger)},c._handleGroupedCallbacks=function(){var a,b;for(c._handlingGroupedCallbacks=!0,a=0;a<c._triggeredEntries.length;a++)b=c._triggeredEntries[a],b.handleGroupedCallback();for(c._handlingRecursiveGroupedCallbacks=!0,a=0;a<c._triggeredEntries.length;a++)b=c._triggeredEntries[a],b.triggeredAgain&&b.handleGroupedCallback();for(c._handlingRecursiveGroupedCallbacks=!1,c._handlingGroupedCallbacks=!1,a=0;a<c._triggeredEntries.length;a++)b=c._triggeredEntries[a],b.triggered=b.triggeredAgain=!1;c._triggeredEntries.length=0};var d=c.prototype;d.trigger=function(){c._handlingRecursiveGroupedCallbacks?this.handleGroupedCallback():this.triggered?c._handlingGroupedCallbacks&&(this.triggeredAgain=!0):(c._triggeredEntries.push(this),this.triggered=!0)},d.handleGroupedCallback=function(){if(this.context){for(var a=this.context,b=0;b<a.length;b++)WeaveAPI.SessionManager.objectWasDisposed(a[b])&&a.splice(b--,1);if(0===a.length)return this.dispose(),void c._entryLookup["delete"](this.callback);0===this.recursionCount&&(this.recursionCount++,this.callback.apply(),this.recursionCount--),this.triggeredAgain=!1}},weavecore.GroupedCallbackEntry=c}(),this.weavecore||(this.weavecore={}),function(){function a(){this.childToParentMap=new Map,this.parentToChildMap=new Map,this.ownerToChildMap=new Map,this.childToOwnerMap=new Map,this.linkableObjectToCallbackCollectionMap=new Map,this.debugBusyTasks=!1,Object.defineProperty(this,"_disposedObjectsMap",{value:new Map}),Object.defineProperty(this,"_treeCallbacks",{value:new weavecore.CallbackCollection})}var b=a.prototype;b.registerLinkableChild=function(a,b,c,d){if(void 0===d&&(d=!1),!a instanceof weavecore.ILinkableObject)return void console.log("registerLinkableChild(): Parent does not inherit ILinkableObject.");if(!b instanceof weavecore.ILinkableObject)return void console.log("registerLinkableChild(): child does not inherit ILinkableObject.");if(null!==c&&void 0!==c){var e=this.getCallbackCollection.call(this,b);d?e.addGroupedCallback(a,c):e.addImmediateCallback(a,c)}if(this.registerDisposableChild(a,b),void 0===this.childToParentMap.get(b).get(a)){this.childToParentMap.get(b).set(a,!0),this.parentToChildMap.get(a).set(b,!0);var f=this.getCallbackCollection(a);this.getCallbackCollection(b).addImmediateCallback(a,f.triggerCallbacks.bind(f),!1)}return this._treeCallbacks.triggerCallbacks(),b},b.registerDisposableChild=function(a,b){return void 0===this.ownerToChildMap.get(a)&&(this.ownerToChildMap.set(a,new Map),this.parentToChildMap.set(a,new Map)),void 0===this.childToOwnerMap.get(b)&&(this.childToOwnerMap.set(b,a),this.ownerToChildMap.get(a).set(b,!0),this.childToParentMap.set(b,new Map)),b},b.unregisterLinkableChild=function(a,b){this.childToParentMap.get(b)&&this.childToParentMap.get(b)["delete"](a),this.parentToChildMap.get(a)&&this.parentToChildMap(a)["delete"](b),this.getCallbackCollection(b).removeCallback(this.getCallbackCollection(a).triggerCallbacks.bind(a)),this._treeCallbacks.triggerCallbacks()},b.excludeLinkableChildFromSessionState=function(a,b){return null===a||null===b||void 0===a||void 0===b?void console.log("SessionManager.excludeLinkableChildFromSessionState(): Parameters cannot be null."):(void 0!==this.childToParentMap.get(b)&&this.childToParentMap.get(b).get(a)&&this.childToParentMap.get(b).set(a,!1),void(void 0!==this.parentToChildMap.get(a)&&this.parentToChildMap.get(a).get(b)&&this.parentToChildMap.get(a).set(b,!1)))},b._getRegisteredChildren=function(a){var b=[];if(void 0!==this.parentToChildMap.get(a))for(var c in this.parentToChildMap.get(a))b.push(c);return b},b.getLinkableOwner=function(a){return this.childToOwnerMap.get(a)},b.getSessionStateTree=function(b,c,d){var e=new weavecore.WeaveTreeItem;return e.label=c,e.source=b,e.children=a.prototype._getTreeItemChildren.bind(this),e.data=d,e},b._getTreeItemChildren=function(a){var b,c,d=a.source,e=a.data,f=[],g=[],h=new Map;if(d instanceof weavecore.LinkableHashMap){g=d.getNames();for(var i=d.getObjects(),j=0;j<g.length;j++)if(b=i[j],this.childToParentMap.get(b)&&this.childToParentMap.get(b).get(d)){if(void 0!==h.get(b))continue;h.set(b,!0),c=this.getSessionStateTree(b,g[j],e),null!==c&&void 0!==c&&f.push(c)}}else{console.log("Linkable dynamic object not yet supported - only Linkablehashmap")}return 0===f.length&&(f=null),null===e||void 0===e?f:null!==f&&void 0!==f||d instanceof e?f:null},b.addTreeCallback=function(a,b,c){void 0===c&&(c=!1),this._treeCallbacks.addGroupedCallback(a,b,c)},b.removeTreeCallback=function(a){this._treeCallbacks.removeCallback(a)},b.copySessionState=function(a,b){var c=this.getSessionState(a);this.setSessionState(b,c,!0)},b._applyDiff=function(a,b){if(null===a||void 0===a||"object"!=typeof a)return b;for(var c in b)a[c]=this._applyDiff(a[c],b[c]);return a},b.setSessionState=function(a,b,c){if(void 0===c&&(c=!0),null===a||void 0===a)return void console.log("SessionManager.setSessionState(): linkableObject cannot be null.");if(a instanceof weavecore.ILinkableObject&&a.setSessionState){var d=a;return void(c===!1&&b&&"Object"===b.constructor.name?d.setSessionState.call(d,this._applyDiff.call(this,Object.create(d.getSessionState.call(d)),b)):d.setSessionState.call(d,b))}},b.getSessionState=function(a){if(null===a||void 0===a)return console.log("SessionManager.getSessionState(): linkableObject cannot be null."),null;var b=null;return(a instanceof weavecore.ILinkableObject||a.getSessionState)&&(b=a.getSessionState()),b},b.getCallbackCollection=function(a){if(null===a||void 0===a)return null;if(a instanceof weavecore.CallbackCollection)return a;var b=this.linkableObjectToCallbackCollectionMap.get(a);return(null===b||void 0===b)&&(b=this.registerDisposableChild(a,new weavecore.CallbackCollection),weavecore.CallbackCollection.debug&&(b._linkableObject=a),this.linkableObjectToCallbackCollectionMap.set(a,b)),b},b.objectWasDisposed=function(a){if(null===a||void 0===a)return!1;if(a instanceof weavecore.ILinkableObject){var b=this.getCallbackCollection(a);if(b)return b.wasDisposed}return void 0!==this._disposedObjectsMap.get(a)},b.disposeObject=function(a){if(null!==a&&void 0!==a&&!this._disposedObjectsMap.get(a)){this._disposedObjectsMap.set(a,!0);try{a.hasOwnProperty("dispose")&&a.dispose()}catch(b){console.log(b)}var c=a;if(c){var d=this.getCallbackCollection(c);d!==c&&this.disposeObject(d)}if(void 0!==this.childToParentMap.get(a)){for(var e in this.childToParentMap.get(a))void 0!==this.parentToChildMap(e)&&this.parentToChildMap.get(e)["delete"](a);this.childToParentMap["delete"](a)}var f=this.childToOwnerMap.get(a);(null!==f||void 0!==f)&&(void 0!==this.ownerToChildMap.get(f)&&this.ownerToChildMap.get(f)["delete"](a),this.childToOwnerMap["delete"](a));var g=this.ownerToChildMap.get(a);if(null!==g&&void 0!==g){this.ownerToChildMap["delete"](a),this.parentToChildMap["delete"](a);for(var h in g)this.disposeObject(h)}this._treeCallbacks.triggerCallbacks()}},b.computeDiff=function(b,c){var d,e=typeof b;if(typeof c!==e)return c;if("number"===e)return isNaN(b)&&isNaN(c)?void 0:b!==c?c:void 0;if(null===b||void 0===b||null===c||void 0===c||"object"!==e)return b!==c?c:void 0;if(Array.isArray(b)&&Array.isArray(c)){if(!weavecore.DynamicState.isDynamicStateArray(b)&&!weavecore.DynamicState.isDynamicStateArray(c))return 0===weavecore.StandardLib.compare(b,c)?void 0:c;var f,g,h,i,j,k=!1,l={};for(f=0;f<b.length;f++)g=b[f],h=g[weavecore.DynamicState.OBJECT_NAME],l[h||""]=g;b.length!==c.length&&(k=!0);var m=[];for(f=0;f<c.length;f++){g=c[f],h=g[weavecore.DynamicState.OBJECT_NAME],i=g[weavecore.DynamicState.CLASS_NAME],j=g[weavecore.DynamicState.SESSION_STATE];var n=l[h||""];if(delete l[h||""],void 0!==n&&n[weavecore.DynamicState.CLASS_NAME]===i){if(i=null,d=this.computeDiff(n[weavecore.DynamicState.SESSION_STATE],j),void 0===d){m.push(h),k||b[f][weavecore.DynamicState.OBJECT_NAME]==h||(k=!0);continue}j=d}m.push(weavecore.DynamicState.create(h||null,i,j)),k=!0}for(h in l)m.push(weavecore.DynamicState.create(h||null,a.DIFF_DELETE)),k=!0;return k?m:void 0}var o=void 0;for(var p in b)d=computeDiff(b[p],c[p]),void 0!==d&&(o||(o={}),o[p]=d);for(var q in c)void 0===b[q]&&(o||(o={}),o[q]=c[q]);return o},b.combineDiff=function(a,b){var c=typeof a,d=typeof b;if(null===a||void 0===a||null===b||void 0===b||c!==d||"object"!==c)a="object"===d?Object.create(b):b;else if(Array.isArray(a)&&Array.isArray(b)){var e;if(weavecore.DynamicState.isDynamicStateArray(a)||weavecore.DynamicState.isDynamicStateArray(b)){var f,g,h={};for(e=0;e<a.length;e++)f=a[e],g="string"==typeof f||f instanceof String||null===f||void 0===f?f:f[weavecore.DynamicState.OBJECT_NAME],h[g]=f,a[e]=g;for(e=0;e<b.length;e++){if(f=b[e],g="string"==typeof f||f instanceof String||null===f||void 0===f?f:f[weavecore.DynamicState.OBJECT_NAME],h.hasOwnProperty(g)){for(var i=a.indexOf(g);i<a.length-1;i++)a[i]=a[i+1];a[a.length-1]=g}else a.push(g);var j=h[g];if("string"==typeof j||j instanceof String||null===j||void 0===j)h[g]="string"==typeof f||f instanceof String||null===f||void 0===f?f:Object.create(f);else if(!("string"==typeof f||f instanceof String||null===f||void 0===f)){var k=f[weavecore.DynamicState.CLASS_NAME];k&&k!=j[weavecore.DynamicState.CLASS_NAME]?h[g]=Object.create(f):j[weavecore.DynamicState.SESSION_STATE]=this.combineDiff(j[weavecore.DynamicState.SESSION_STATE],f[weavecore.DynamicState.SESSION_STATE])}}for(e=0;e<a.length;e++)a[e]=h[a[e]]}else for(e=a.length=b.length;e--;){var l=b[e];a[e]=null===l||void 0===l||"object"!=typeof l?l:this.combineDiff(a[e],l)}}else for(var m in b)a[m]=this.combineDiff(a[m],b[m]);return a},Object.defineProperty(a,"DIFF_DELETE",{value:"delete"}),weavecore.SessionManager=a}(),this.weavecore||(this.weavecore={}),function(){function a(a){if(void 0===a&&(a=null),this.childItemClass,this._recursion={},this._label="",this._children=null,this._source=null,this._cache={},this._counter={},this.data=null,"string"==typeof a)this.label=a,this.data=a;else for(var b in a)this[b]=a[b]}a.createItems=function(a,b){for(var c=0;c!==b.length;)c=b.length,b=[].concat.apply(null,b);return b.map(_mapItems,a).filter(_filterItems)},a._mapItems=function(b){if("function"==typeof b)return new b;if("string"==typeof b||null!==b&&void 0!==b&&"Object"===b.constructor.name){var c=a;return new c(b)}return b},a._filterItems=function(a){return null!==a||void 0!==a};var b=a.prototype;b.getBoolean=function(a,b){if(!this._recursion[b])try{if(this._recursion[b]=!0,this.isSimpleObject(a,"not")&&(a=!this.getBoolean(a.not,"not_"+b)),this.isSimpleObject(a,"or")&&(a=this.getBoolean(a.or,"or_"+b)),"function"==typeof a&&(a=this.evalFunction(a)),a instanceof weavecore.LinkableVariable&&(a=a.getSessionState()),a instanceof Array){var c=0===b.indexOf("or_");for(var a in a)if(a=this.getBoolean(a,"item_"+b),a?c:!c)break}a=a?!0:!1}finally{this._recursion[b]=!1}return a},b.isSimpleObject=function(a,b){if(!(a instanceof Object)||a.constructor!==Object)return!1;var c=!1;for(var d in a){if(c)return!1;if(d!==b)return!1;c=!0}return c},b.getString=function(a,b){if(!this._recursion[b])try{this._recursion[b]=!0,a="function"==typeof a?this.evalFunction(a):a||""}finally{this._recursion[b]=!1}return a},b.getObject=function(a,b){if(!this._recursion[b])try{this._recursion[b]=!0,"function"==typeof a&&(a=this.evalFunction(a))}finally{this._recursion[b]=!1}return a},b.evalFunction=function(a){try{return a.call(this)}catch(b){console.log(b)}return a.call(this,this)},b.isCached=function(a){return this._source&&WeaveAPI.SessionManager.objectWasDisposed(this._source)&&(source=null),this._source&&this._counter[a]===WeaveAPI.SessionManager.getCallbackCollection(this._source).triggerCounter},b.cache=function(a,b){return 1===arguments.length?this._cache[a]:(this._source&&WeaveAPI.SessionManager.objectWasDisposed(this._source)&&(source=null),this._source&&(this._counter[a]=WeaveAPI.SessionManager.getCallbackCollection(this._source).triggerCounter,this._cache[a]=b),b)},b.__defineGetter__("label",function(){const a="label";if(this.isCached(a))return this._cache[a];var b=this.getString(this._label,a);return b||null===this.data||void 0===this.data||(b=String(this.data)),this.cache(a,b)}),b.__defineSetter__("label",function(a){this._counter.label=void 0,this._label=a}),b.__defineGetter__("children",function(){const b="children";if(this.isCached(b))return this._cache[b];var c=this.getObject(this._children,b);if(!c)return this.cache(b,null);var d=c.map(a._mapItems.bind(this),this.childItemClass).filter(a._filterItems.bind(this));return this.cache(b,d)}),b.__defineSetter__("children",function(a){this._counter.children=void 0,this._children=a}),b.__defineGetter__("source",function(){return this._source&&WeaveAPI.SessionManager.objectWasDisposed(this._source)&&(source=null),this._source}),b.__defineSetter__("source",function(a){this._source!=a&&(this._counter={}),this._source=a}),weavecore.WeaveTreeItem=a}(),this.weavecore||(this.weavecore={}),function(){function a(){this.dictionary=new Map}var b=a.prototype;b.get=function(a,b){var c=this.dictionary.get(a);return c?c.get(b):void 0},b.set=function(a,b,c){var d=this.dictionary.get(a);(null===d||void 0===d)&&(d=new Map),this.dictionary.set(a,d),d.set(b,c)},b.removeAllPrimary=function(a){this.dictionary["delete"](a)},b.removeAllSecondary=function(a){for(var b in this.dictionary.keys())this.dictionary.get(b)["delete"](a)},b.remove=function(a,b){var c,d=this.dictionary.get(a);d&&(c=d.get(b),d["delete"](b));for(var e in d)return c;return this.dictionary["delete"](a),c},weavecore.Dictionary2D=a}(),createjs.Ticker.setFPS(50),this.WeaveAPI={},Object.defineProperty(this.WeaveAPI,"TASK_PRIORITY_IMMEDIATE",{value:0}),Object.defineProperty(this.WeaveAPI,"TASK_PRIORITY_HIGH",{value:1}),Object.defineProperty(this.WeaveAPI,"TASK_PRIORITY_NORMAL",{value:2}),Object.defineProperty(this.WeaveAPI,"TASK_PRIORITY_LOW",{value:3}),WeaveAPI.SessionManager=new weavecore.SessionManager,this.weavecore||(this.weavecore={}),function(){function a(a,b){weavecore.CallbackCollection.call(this,this.setEvent.bind(this)),this._eventManager=a,this._eventType=b}function b(){this.averageFrameTime=0,Object.defineProperties(this,{eventManager:{value:new c},frameTimes:{value:[]},_stackTraceMap:{value:new Map},_taskElapsedTime:{value:new Map},_taskStartTime:{value:new Map}}),this._currentTaskStopTime=0,Object.defineProperties(this,{_priorityCallLaterQueues:{value:[[],[],[],[]]},_priorityAllocatedTimes:{value:[Number.MAX_VALUE,300,200,100]}}),this._activePriority=WeaveAPI.TASK_PRIORITY_IMMEDIATE+1,this._activePriorityElapsedTime=0,this._deactivatedMaxComputationTimePerFrame=1e3,this._nextCallLaterPriority=WeaveAPI.TASK_PRIORITY_IMMEDIATE,this.addEventCallback("tick",null,this._handleCallLater.bind(this)),this.maxComputationTimePerFrame=100,this.maxComputationTimePerFrame_noActivity=250}function c(){Object.defineProperty(this,"callbackCollections",{value:{}}),this.userActivity=0,this.event=null,this.eventTime=0,this.shiftKey=!1,this.altKey=!1,this.ctrlKey=!1,this.mouseButtonDown=!1,this.currentFrameStartTime=(new Date).getTime(),this.previousFrameElapsedTime=0,this.pointClicked=!1,this.deactivated=!0,this.useDeactivatedFrameRate=!1,this.triggeredThrottledMouseThisFrame=!1,this.nextThrottledMouseMoveTime=0,this.throttledMouseMoveInterval=100;for(var b=0;b<a.eventTypes.length;b++){var c=a.eventTypes[b];this.callbackCollections[c]=new a(this,c)}for(var d in this.callbackCollections)this.callbackCollections[d].listenToStage();this.event}Object.defineProperty(a,"eventTypes",{value:["tick"]}),a.prototype=new weavecore.CallbackCollection,a.prototype.constructor=a;var d=a.prototype;d.setEvent=function(a){this._eventManager.event=a},d.runEventCallbacks=function(a){var b=this._eventManager.event;this._runCallbacksImmediately(a),this._preCallback(b)},d.listenToStage=function(){createjs.Ticker.addEventListener(this._eventType,this._tickerListener.bind(this)),this.addDisposeCallback(null,function(){createjs.Ticker.removeEventListener(this._eventType,this._tickerListener.bind(this))})},d._tickerListener=function(a){this._eventManager.eventTime=(new Date).getTime(),"tick"===this._eventType&&(this._eventManager.userActivity>0&&!this._eventManager.mouseButtonDown&&this._eventManager.userActivity--,this._eventManager.previousFrameElapsedTime=this._eventManager.eventTime-this._eventManager.currentFrameStartTime,this._eventManager.currentFrameStartTime=this._eventManager.eventTime),"tick"===this._eventType&&this.runEventCallbacks(a)},weavecore.EventCallbackCollection=a;var d=b.prototype;d.getMaxComputationTimePerFrame=function(){return this.maxComputationTimePerFrame},d.setMaxComputationTimePerFrame=function(a){this.maxComputationTimePerFrame=a},d.getTaskPriorityTimeAllocation=function(a){return this._priorityAllocatedTimes[a]},d.setTaskPriorityTimeAllocation=function(a,b){this._priorityAllocatedTimes[a]=Math.max(b,5)},b._time,b._times=[],d.callLater=function(a,b){return null===b||void 0===b?void console.log('StageUtils.callLater(): received null "method" parameter'):(this._priorityCallLaterQueues[this._nextCallLaterPriority].push(arguments),void(this._nextCallLaterPriority=WeaveAPI.TASK_PRIORITY_IMMEDIATE))},d._handleCallLater=function(){0==this.maxComputationTimePerFrame&&(this.maxComputationTimePerFrame=100);var a;if(a=this.eventManager.useDeactivatedFrameRate?this._deactivatedMaxComputationTimePerFrame:this.eventManager.userActivity?this.maxComputationTimePerFrame:this.maxComputationTimePerFrame_noActivity,!this.eventManager.event)return void console.log("StageUtils.handleCallLater(): _event is null. This should never happen.");"tick"===this.eventManager.event.type&&this.eventManager.previousFrameElapsedTime>3e3&&console.log("Previous frame took",this.eventManager.previousFrameElapsedTime,"ms");var b,c,d,e,f=this.eventManager.currentFrameStartTime+a;this._currentTaskStopTime=f;var g,h=this._priorityCallLaterQueues[WeaveAPI.TASK_PRIORITY_IMMEDIATE];for(g=h.length;g>0;g--){if(e=(new Date).getTime(),e>f)return;b=h.shift(),d=this._stackTraceMap[b],WeaveAPI.SessionManager.objectWasDisposed(b[0])||(c=b[2],null!=c&&c.length>0?b[1].apply(null,c):b[1].call())
}var i=WeaveAPI.TASK_PRIORITY_IMMEDIATE+1,j=this._activePriority===i?this._priorityCallLaterQueues.length-1:this._activePriority-1,k=(new Date).getTime(),l=this._priorityAllocatedTimes[this._activePriority];this.eventManager.useDeactivatedFrameRate?l=l*this._deactivatedMaxComputationTimePerFrame/this.maxComputationTimePerFrame:this.eventManager.userActivity||(l=l*this.maxComputationTimePerFrame_noActivity/this.maxComputationTimePerFrame);var m=Math.min(f,k+l-this._activePriorityElapsedTime);for(h=this._priorityCallLaterQueues[this._activePriority],g=h.length;;)if(e=(new Date).getTime(),0===g||e>m){if(this._activePriorityElapsedTime+=e-k,e>f||this._activePriority===j)return;for(var n=0,o=i;o<this._priorityCallLaterQueues.length;o++)n+=this._priorityCallLaterQueues[o].length;if(0===n)break;this._activePriority++,this._activePriorityElapsedTime=0,this._activePriority===this._priorityCallLaterQueues.length&&(this._activePriority=i),k=e,l=this._priorityAllocatedTimes[_activePriority],this.eventManager.useDeactivatedFrameRate?l=l*this._deactivatedMaxComputationTimePerFrame/this.maxComputationTimePerFrame:this.eventManager.userActivity||(l=l*this.maxComputationTimePerFrame_noActivity/this.maxComputationTimePerFrame),m=Math.min(f,k+l),h=this._priorityCallLaterQueues[this._activePriority],g=h.length}else g--,_currentTaskStopTime=m,b=h.shift(),d=this._stackTraceMap[b],WeaveAPI.SessionManager.objectWasDisposed(b[0])||(c=b[2],null!=c&&c.length>0?b[1].apply(null,c):b[1].call())},d.addEventCallback=function(a,b,c,d){(null===d||void 0===d)&&(d=!1);var e=this.eventManager.callbackCollections[a];null!==e&&void 0!==e?e.addImmediateCallback(b,c,d):console.log("(StageUtils) Unsupported event: ",a)},weavecore.StageUtils=new b,weavecore.EventManager=c}(),this.weavecore||(this.weavecore={}),function(){function a(a,c,d,e){void 0===a&&(a=null),void 0===c&&(c=null),void 0===e&&(e=!0),weavecore.CallbackCollection.call(this),this._verifier=c,this._sessionStateWasSet=!1,this._primitiveType=!1,this._sessionStateType=null,this._sessionStateInternal=void 0,this._sessionStateExternal=void 0,this._locked=!1,a!==Object&&(this._sessionStateType=a,this._primitiveType="string"===this._sessionStateType||"number"===this._sessionStateType||"boolean"===this._sessionStateType),void 0!==d&&(this.setSessionState(d),e&&this._triggerCounter>weavecore.CallbackCollection.DEFAULT_TRIGGER_COUNT&&weavecore.StageUtils.callLater(this,b.bind(this)))}function b(){this._wasDisposed||this._triggerCounter!==weavecore.CallbackCollection.DEFAULT_TRIGGER_COUNT+1||this.triggerCallbacks()}a.prototype=new weavecore.CallbackCollection,a.prototype.constructor=a;var c=a.prototype;c.getSessionStateType=function(){return this._sessionStateType},c.getSessionState=function(){return this._sessionStateExternal},c.setSessionState=function(a){if(!this._locked&&(null!==this._sessionStateType&&void 0!==this._sessionStateType&&(a=a),null===this._verifier||void 0===this._verifier||this._verifier(a))){var b=!1,c=null;null!==a&&void 0!==a&&(c=typeof a,"object"===c&&a.constructor!==Object&&a.constructor!==Array&&(a=Object.create(a),b=!0)),this._sessionStateWasSet&&this.sessionStateEquals(a)||("object"===c?(b||(a=Object.create(a)),this._sessionStateExternal=a,this._sessionStateInternal=Object.create(a)):this._sessionStateExternal=this._sessionStateInternal=a,this._sessionStateWasSet=!0,this.triggerCallbacks())}},c.sessionStateEquals=function(a){return this._primitiveType?this._sessionStateInternal===a:0===weavecore.StandardLib.compare(this._sessionStateInternal,a)},c.detectChanges=function(){this.sessionStateEquals(this._sessionStateExternal)||this.triggerCallbacks()},c.lock=function(){this._locked=!0},c.__defineGetter__("locked ",function(){return this._locked}),c.dispose=function(){weavecore.CallbackCollection.prototype.dispose.call(this),this.setSessionState(null)},weavecore.LinkableVariable=a}(),this.weavecore||(this.weavecore={}),function(){function a(a,b,c){void 0===a&&(a=0/0),void 0===b&&(b=null),void 0===c&&(c=!0),weavecore.LinkableVariable.call(this,"number",b,arguments.length?a:void 0,c)}a.prototype=new weavecore.LinkableVariable,a.prototype.constructor=a;var b=a.prototype;b.__defineGetter__("value",function(){return this._sessionStateExternal}),b.__defineSetter__("value",function(a){this.setSessionState(a)}),b.setSessionState=function(a){"number"!=typeof a&&(a=null===a||""===a||void 0===a?0/0:Number(a)),weavecore.LinkableVariable.prototype.setSessionState.call(this,a)},b.sessionStateEquals=function(a){return(null===this._sessionStateInternal||void 0===this._sessionStateInternal)&&(this._sessionStateInternal=this._sessionStateExternal=0/0),isNaN(this._sessionStateInternal)&&isNaN(a)?!0:this._sessionStateInternal===a},weavecore.LinkableNumber=a}(),this.weavecore||(this.weavecore={}),function(){function a(a,b,c){void 0===b&&(b=null),void 0===c&&(c=!0),weavecore.LinkableVariable.call(this,"boolean",b,a,c)}a.prototype=new weavecore.LinkableVariable,a.prototype.constructor=a;var b=a.prototype;b.__defineGetter__("value",function(){return this._sessionStateExternal}),b.__defineSetter__("value",function(a){this.setSessionState(a)}),b.setSessionState=function(a){"string"==typeof a&&(a=0===weavecore.ObjectUtil.stringCompare(a,"true",!0)),weavecore.LinkableVariable.prototype.setSessionState.call(this,a?!0:!1)},weavecore.LinkableBoolean=a}(),this.weavecore||(this.weavecore={}),function(){function a(){weavecore.CallbackCollection.call(this,this._setCallbackVariables),this._lastNameAdded=null,this._lastObjectAdded=null,this._lastNameRemoved=null,this._lastObjectRemoved=null}a.prototype=new weavecore.CallbackCollection,a.prototype.constructor=a;var b=a.prototype;b._setCallbackVariables=function(a,b,c){this._lastNameAdded=b?a:null,this._lastObjectAdded=b,this._lastNameRemoved=c?a:null,this._lastObjectRemoved=c},b.runCallbacks=function(a,b,c){var d=this._lastNameAdded||this._lastNameRemoved,e=this._lastObjectAdded,f=this._lastObjectRemoved;this._runCallbacksImmediately(a,b,c),this._setCallbackVariables.call(this,d,e,f)},b.__defineGetter__("lastNameAdded",function(){return this._lastNameAdded}),b.__defineGetter__("lastObjectAdded",function(){return this._lastObjectAdded}),b.__defineGetter__("lastNameRemoved",function(){return this._lastNameRemoved}),b.__defineGetter__("lastObjectRemoved",function(){return this._lastObjectRemoved}),weavecore.ChildListCallbackInterface=a}(),this.weavecore||(this.weavecore={}),function(){function LinkableHashMap(a){void 0===a&&(a=null),weavecore.CallbackCollection.call(this),this._typeRestriction,this._typeRestrictionClassName,null!==a&&void 0!==a&&(this._typeRestriction=a,this._typeRestrictionClassName=a.name),Object.defineProperty(this,"_childListCallbacks",{value:WeaveAPI.SessionManager.registerLinkableChild(this,new weavecore.ChildListCallbackInterface)}),Object.defineProperty(this,"_orderedNames",{value:[]}),Object.defineProperty(this,"_nameToObjectMap",{value:{}}),Object.defineProperty(this,"_objectToNameMap",{value:new Map}),Object.defineProperty(this,"_nameIsLocked",{value:{}}),Object.defineProperty(this,"_previousNameMap",{value:{}})}LinkableHashMap.prototype=new weavecore.CallbackCollection,LinkableHashMap.prototype.constructor=LinkableHashMap;var p=LinkableHashMap.prototype;p.__defineGetter__("typeRestriction",function(){return this._typeRestriction}),p.__defineGetter__("childListCallbacks",function(){return this._childListCallbacks}),p.getNames=function(a){void 0===a&&(a=null);for(var b=[],c=0;c<this._orderedNames.length;c++){var d=this._orderedNames[c];(null===a||this._nameToObjectMap[d]instanceof a)&&b.push(d)}return b},p.getObjects=function(a){void 0===a&&(a=null);for(var b=[],c=0;c<this._orderedNames.length;c++){var d=this._orderedNames[c],e=this._nameToObjectMap[d];(null===a||void 0===a||e instanceof a)&&b.push(e)}return b},p.getObject=function(a){return this._nameToObjectMap[a]},p.getName=function(a){return this._objectToNameMap.get(a)},p.setNameOrder=function(a){var b,c,d=!1,e=this._orderedNames.length,f={};for(c=0;c<a.length;c++)b=a[c],void 0!==this._nameToObjectMap[b]&&void 0===f[b]&&(f[b]=!0,this._orderedNames.push(b));var g=this._orderedNames.length-e;for(c=0;g>c;c++){var h=e+c,i=this._orderedNames.indexOf(this._orderedNames[h]);h-i!==g&&(d=!0),this._orderedNames[i]=null}var j=0;for(c=0;c<this._orderedNames.length;c++)null!==this._orderedNames[c]&&void 0!==this._orderedNames[c]&&(this._orderedNames[j++]=this._orderedNames[c]);this._orderedNames.length=j,d&&this._childListCallbacks.runCallbacks(null,null,null)},p.requestObject=function(a,b,c){var d=b?b.name:null,e=this._initObjectByClassName.call(this,a,d,c);return b?e:null},p.requestObjectCopy=function(a,b){if(null===b||void 0===b)return this.removeObject(a),null;this.delayCallbacks();var c=b.constructor,d=WeaveAPI.SessionManager.getSessionState(b),e=requestObject(a,c,!1);return null!==e&&void 0!==e&&WeaveAPI.SessionManager.setSessionState(e,d),this.resumeCallbacks(),e},p.renameObject=function(a,b){if(a!==b){this.delayCallbacks();var c=this._orderedNames.concat(),d=c.indexOf(a);d>=0&&c.splice(d,1,b),this.requestObjectCopy(b,getObject(a)),this.removeObject(a),this.setNameOrder(c),this.resumeCallbacks()}return this.getObject(b)},p._initObjectByClassName=function(name,className,lockObject){if(className)if(name||(name=generateUniqueName(className.split("::").pop())),"delete"!==className){var classDef=eval("weavecore."+className),object=this._nameToObjectMap[name];object&&object.constructor===classDef?lockObject&&this.lockObject(name):this._createAndSaveNewObject.call(this,name,classDef,lockObject)}else this.removeObject(name);else this.removeObject(name);return this._nameToObjectMap[name]},p._createAndSaveNewObject=function(a,b,c){if(!this._nameIsLocked[a]){this.removeObject(a);var d=new b;WeaveAPI.SessionManager.registerLinkableChild(this,d),this._nameToObjectMap[a]=d,this._objectToNameMap.set(d,a),this._orderedNames.push(a),this._previousNameMap[a]=!0,c&&this.lockObject(a),this._childListCallbacks.runCallbacks(a,d,null)}},p.lockObject=function(a){null!==a&&void 0!==a&&null!==this._nameToObjectMap[a]&&void 0!==this._nameToObjectMap[a]&&(this._nameIsLocked[a]=!0)},p.objectIsLocked=function(a){return this._nameIsLocked[a]?!0:!1},p.removeObject=function(a){if(a&&!this._nameIsLocked[a]){var b=this._nameToObjectMap[a];if(null!==b&&void 0!==b){delete this._nameToObjectMap[a],this._objectToNameMap["delete"](b);var c=this._orderedNames.indexOf(a);this._orderedNames.splice(c,1),this._childListCallbacks.runCallbacks(a,null,b),WeaveAPI.SessionManager.disposeObject(b)}}},p.removeAllObjects=function(){this.delayCallbacks();for(var a=this._orderedNames.concat(),b=0;b<a.length;b++)this.removeObject(a[b]);this.resumeCallbacks()},p.dispose=function(){CallbackCollection.prototype.dispose.call(this),this.removeAllObjects();for(var a=this._orderedNames.concat(),b=0;b<a.length;b++){var c=a[b];this._nameIsLocked[c]=void 0,this.removeObject(c)}},p.generateUniqueName=function(a){for(var b=1,c=a;void 0!==this._previousNameMap[c];)c=a+ ++b;return c},p.getSessionState=function(){for(var a=new Array(this._orderedNames.length),b=0;b<this._orderedNames.length;b++){var c=this._orderedNames[b],d=this._nameToObjectMap[c];a[b]=weavecore.DynamicState.create(c,d.constructor.name,WeaveAPI.SessionManager.getSessionState(d))}return a},p.setSessionState=function(a,b){if(null!==a&&void 0!==a){this.delayCallbacks();var c,d,e,f,g=b?{}:null,h={},i=[];if(null!==a&&void 0!==a){for(c=0;c<a.length;c++)f=a[c],weavecore.DynamicState.isDynamicState(f)&&(d=f[weavecore.DynamicState.OBJECT_NAME],e=f[weavecore.DynamicState.CLASS_NAME],null!==d&&void 0!==d&&null!==e&&void 0!==e&&this._nameToObjectMap[d]!==this._initObjectByClassName.call(this,d,e)&&(h[d]=!0));for(c=0;c<a.length;c++)if(f=a[c],"string"!=typeof f){if(weavecore.DynamicState.isDynamicState(f)&&(d=f[weavecore.DynamicState.OBJECT_NAME],null!==d&&void 0!==d)){var j=this._nameToObjectMap[d];null!==j&&void 0!==j&&(WeaveAPI.SessionManager.setSessionState(j,f[weavecore.DynamicState.SESSION_STATE],h[d]||b),b&&(g[d]=!0),i.push(d))}}else d=f,b&&(g[d]=!0),i.push(d)}if(b)for(var k=this._orderedNames.concat(),l=0;l<k.length;l++){var d=torderedNamesCopy[l];g[d]!==!0&&this.removeObject(d)}this.setNameOrder(i),this.resumeCallbacks()}},weavecore.LinkableHashMap=LinkableHashMap}(),this.weavecore||(this.weavecore={}),function(){function a(a,b,c,d,e){this.id=a,this.forward=b,this.backward=c,this.triggerDelay=d,this.diffDuration=e}function b(){var a=(new Date).getTime();return a}function c(a,d){void 0===d&&(d=0),this._subject=a,this._syncDelay=d,this._prevState=WeaveAPI.SessionManager.getSessionState(this._subject),c.prototype.enableLogging=WeaveAPI.SessionManager.registerLinkableChild(this,new weavecore.LinkableBoolean(!0),this.synchronizeNow.bind(this)),WeaveAPI.SessionManager.registerDisposableChild(this._subject,this);var e=WeaveAPI.SessionManager.getCallbackCollection(this._subject);e.addImmediateCallback(this,this._immediateCallback.bind(this)),e.addGroupedCallback(this,this._groupedCallback.bind(this)),this._undoHistory=[],this._redoHistory=[],this._nextId=0,this._undoActive=!1,this._redoActive=!1,this._syncTime=b(),this._triggerDelay=-1,this._saveTime=0,this._savePending=!1,Object.defineProperty(c,"debug",{value:!0,writable:!0}),Object.defineProperty(c,"enableHistoryRewrite",{value:!0,writable:!0})}function d(a){for(var b=this._undoHistory.concat(),c=0;c<b.length;c++)b[c]=b[c].id;var d=this._redoHistory.concat();for(c=0;c<d.length;c++)d[c]=d[c].id;a&&(console.log("<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<"),console.log("NEW HISTORY (backward) "+a.id+":",a.backward),console.log("==============================================================="),console.log("NEW HISTORY (forward) "+a.id+":",a.forward),console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>")),console.log("undo ["+b+"]","redo ["+d+"]")}a.convertGenericObjectsToLogEntries=function(b,c){for(var d=0;d<b.length;d++){var e=b[d];e instanceof a||(b[d]=new a(e.id,e.forward,e.backward,e.triggerDelay||c,e.diffDuration))}return b};var e=c.prototype;e.dispose=function(){(null===this._undoHistory||void 0===this._undoHistory)&&console.log("SessionStateLog.dispose() called more than once"),this._subject=null,this._undoHistory=null,this._redoHistory=null},e.synchronizeNow=function(){this._saveDiff.call(this,!0)},e._immediateCallback=function(){if(this.enableLogging.value&&(this._saveTime=Number.MAX_VALUE,this._savePending||(this._savePending=!0,this._saveDiff.call(this)),c.debug&&(this._undoActive||this._redoActive))){var a=WeaveAPI.SessionManager.getSessionState(this._subject),b=WeaveAPI.SessionManager.computeDiff(this._prevState,a);console.log("immediate diff:",b)}},e._groupedCallback=function(){if(this.enableLogging.value&&(this._immediateCallback(),this._saveTime=b()+this._syncDelay,c.debug&&(this._undoActive||this._redoActive))){var a=WeaveAPI.SessionManager.getSessionState(this._subject),d=WeaveAPI.SessionManager.computeDiff(this._prevState,a);console.log("grouped diff:",d)}},e._saveDiff=function(e){if(void 0===e&&(e=!1),!this.enableLogging.value)return void(this._savePending=!1);var f=b();if(this._triggerDelay<0&&(this._triggerDelay=f-this._rsyncTime),!e&&b()<this._saveTime)return void weavecore.StageUtils.callLater(this,this._saveDiff.bind(this));var g=WeaveAPI.SessionManager.getCallbackCollection(this);g.delayCallbacks.call(g);var h=WeaveAPI.SessionManager.getSessionState(this._subject),i=WeaveAPI.SessionManager.computeDiff(this._prevState,h);if(void 0!==i){var j,k,l=f-(this._rsyncTime+this._triggerDelay),m=WeaveAPI.SessionManager.computeDiff(h,this._prevState);this._undoActive?(j=this._redoHistory[0],k=new a(this._nextId++,m,i,j.triggerDelay,j.diffDuration),this.enableHistoryRewrite?this._redoHistory[0]=k:0!==StandardLib.compare(j.forward,k.forward)&&this._redoHistory.unshift(k)):(k=new a(this._nextId++,i,m,this._triggerDelay,l),this._redoActive&&(j=this._undoHistory.pop(),k.triggerDelay=j.triggerDelay,k.diffDuration=j.diffDuration,this.enableHistoryRewrite||0!==StandardLib.compare(j.forward,k.forward)||(k=j)),this._undoHistory.push(k)),c.debug&&d.call(this,k),this._rsyncTime=f,g.triggerCallbacks.call(g)}(this._undoActive||this._redoActive)&&(this._rsyncTime=f),this._prevState=h,this._undoActive=!1,this._redoActive=!1,this._savePending=!1,this._triggerDelay=-1,g.resumeCallbacks.call(g)},e.undo=function(a){isNaN(a)&&(a=1),this.applyDiffs.call(this,-a)},e.redo=function(a){isNaN(a)&&(a=1),this.applyDiffs.call(this,a)},e.clearHistory=function(a){void 0===a&&(a=0);var b=WeaveAPI.SessionManager.getCallbackCollection(this);b.delayCallbacks(),this.synchronizeNow(),0>=a&&(this._undoHistory.length>0&&b.triggerCallbacks(),this._undoHistory.length=0),a>=0&&(this._redoHistory.length>0&&b.triggerCallbacks(),this._redoHistory.length=0),b.resumeCallbacks()},e.applyDiffs=function(a){var b=Math.min(Math.abs(a),0>a?this._undoHistory.length:this._redoHistory.length);if(b>0){var d,e,f=c.debug&&1===b;!this._savePending||this._undoActive||this._redoActive||this.synchronizeNow();var g=b>2,h=null;if(WeaveAPI.SessionManager.getCallbackCollection(this._subject).delayCallbacks.call(this._subject),!this.enableLogging.value){var i=WeaveAPI.SessionManager.getSessionState(this._subject);h=WeaveAPI.SessionManager.computeDiff(i,this._prevState),null!==h&&void 0!==h&&(g=!0)}for(;b-->0;)if(0>a?(d=this._undoHistory.pop(),this._redoHistory.unshift(d),e=d.backward):(d=this._redoHistory.shift(),this._undoHistory.push(d),e=d.forward),f&&console.log("apply "+(0>a?"undo":"redo"),d.id+":",e),0===b&&this.enableLogging.value&&(this._prevState=WeaveAPI.SessionManager.getSessionState(this._subject)),g?(h=WeaveAPI.SessionManager.combineDiff(h,e),1>=b&&(WeaveAPI.SessionManager.setSessionState(this._subject,h,!1),g=!1)):WeaveAPI.SessionManager.setSessionState(this._subject,e,!1),f){var j=WeaveAPI.SessionManager.getSessionState(this._subject),k=WeaveAPI.SessionManager.computeDiff(this._prevState,j);console.log("resulting diff:",k)}WeaveAPI.SessionManager.getCallbackCollection(this._subject).resumeCallbacks.call(this._subject),this._undoActive=0>a&&this._savePending,this._redoActive=a>0&&this._savePending,this._savePending||(this._prevState=WeaveAPI.SessionManager.getSessionState(this._subject));var l=WeaveAPI.SessionManager.getCallbackCollection(this);l.triggerCallbacks.call(l)}},e.__defineGetter__("undoHistory",function(){return this._undoHistory}),e.__defineGetter__("redoHistory",function(){return this._redoHistory}),e.getSessionState=function(){var a=WeaveAPI.SessionManager.getCallbackCollection(this);a.delayCallbacks(),this.synchronizeNow.call(this);var b={version:0,currentState:this._prevState,undoHistory:this._undoHistory.concat(),redoHistory:this._redoHistory.concat(),nextId:this._nextId};return a.resumeCallbacks(),b},e.setSessionState=function(c){var d=WeaveAPI.SessionManager.getCallbackCollection(this);d.delayCallbacks(),this.enableLogging.delayCallbacks();try{var e=c.version;switch(e){case 0:this._prevState=c.currentState,this._undoHistory=a.convertGenericObjectsToLogEntries(c.undoHistory,this._syncDelay),this._redoHistory=a.convertGenericObjectsToLogEntries(c.redoHistory,this._syncDelay),this._nextId=c.nextId;break;default:console.log("Weave history format version "+e+" is unsupported.")}this._undoActive=!1,this._redoActive=!1,this._savePending=!1,this._saveTime=0,this._triggerDelay=-1,this._rsyncTime=b(),WeaveAPI.SessionManager.setSessionState(this._subject,this._prevState)}finally{this.enableLogging.resumeCallbacks(),d.triggerCallbacks(),d.resumeCallbacks()}},weavecore.SessionStateLog=c}();
